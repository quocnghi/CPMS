@model IEnumerable<Capstone.Areas.CMS.Models.HocphanData>
@{
    ViewBag.Title = "EditCTDTStep3";
    Layout = "~/Areas/CMS/Views/Shared/_Layout.cshtml";
    int i = 1;
    int x = 1;
    int y = 1;
    int z = 1;

    var arrKhoikt = Model.FirstOrDefault().khoikienthuc.FirstOrDefault().MaKhoiKT.ToString();
    string arrHocky = "";
    if (Model.FirstOrDefault().khdaotao.Count > 0)
    {
        arrHocky = Model.FirstOrDefault().khdaotao.FirstOrDefault().Hocky.ToString();
    }
}
<link rel="stylesheet" type="text/css" href="~/Content/Curriculum/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css">
<link href="~/Content/Curriculum/assets/libs/toastr/build/toastr.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="~/Content/Curriculum/dist/css/TopButton.css">

<style>
    input {
        border: 5px;
    }
</style>
<div class="page-wrapper">
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title">Chỉnh Sửa Chương Trình Đào Tạo - Bước 3</h4>
                <div class="ml-auto text-right">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Trang chủ</a></li>
                            <li class="breadcrumb-item">Quản lý CTDT</li>
                            <li class="breadcrumb-item"><a href="@Url.Action("List","CTDTKhung", new { area = "CMS" })">Danh sách CTDT khung</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Chỉnh sửa CTDT</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="card">
            <div class="card-body wizard-content">
                <h6 class="card-subtitle"></h6>
                <form @*id="example-form"*@ action="@Url.Action("EditCTDTStep3", "CTDTKhung", new { area = "CMS" })" method="post" class="m-t-40">
                    <div>
                        <h2 style="text-align:center">CHỈNH SỬA NỘI DUNG CHƯƠNG TRÌNH ĐÀO TẠO</h2>
                        <hr />
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6" style="margin-top:10px">
                                        <button type="button" class="btn btn-success" style="color:white" data-toggle="modal" data-target="#addSubjectModal">Thêm học phần</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <br />
                                    <br />
                                    <input type="hidden" id="idmactdt" value="@Model.FirstOrDefault().ctdt.MaCT" />
                                    <table id="zero_config" class="table table-striped table-bordered">
                                        <thead>
                                            <tr style="text-align:center ; background-color:firebrick; color:white">
                                                <th style="text-align:center; vertical-align: middle; width: 3%">STT</th>
                                                <th style="text-align:center; vertical-align: middle">Loại Kiến Thức</th>
                                                <th style="text-align:center; vertical-align: middle">Tên học phần</th>
                                                <th style="text-align:center; vertical-align: middle">TC</th>
                                                <th style="text-align:center; vertical-align: middle">LT</th>
                                                <th style="text-align:center; vertical-align: middle">TH</th>
                                                <th style="text-align:center; vertical-align: middle">ĐA</th>
                                                <th style="text-align:center; vertical-align: middle">TT</th>
                                                <th style="text-align:center; vertical-align: middle">BB/TC</th>
                                                <th style="text-align:center; vertical-align: middle">HK</th>
                                                <th style="text-align:center; vertical-align: middle; width: 10%">Thao Tác</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.FirstOrDefault().khdaotao)
                                            {
                                                <tr class="odd gradeX">
                                                    <td style="text-align:center; vertical-align: middle">@i</td>
                                                    <input type="hidden" id="idmakhdt" value="@item.MaKHDT" />
                                                    <td style="text-align:center ;vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                    <td style="text-align:center ;vertical-align: middle">@item.sc_Hocphan.MaHT - @item.sc_Hocphan.TenMH</td>
                                                    @*Load học phần tiên quyết*@
                                                    @*@{
                                                            string c = "";
                                                            if (item.MonTQ != null)
                                                            {
                                                                string[] hptienquyet = item.MonTQ.Split(',');
                                                                CurriculumManagementSystem.Models.CMSEntities db = new CurriculumManagementSystem.Models.CMSEntities();
                                                                for (z = 0; z < hptienquyet.Length; z++)
                                                                {
                                                                    string mhp = hptienquyet[z];
                                                                    string tenhp = db.sc_Hocphan.Where(s => s.MaMH.ToString() == mhp).FirstOrDefault().TenMH;
                                                                    if (z == hptienquyet.Length - 1)
                                                                    {
                                                                        c += tenhp;
                                                                    }
                                                                    else
                                                                    {
                                                                        c += tenhp + ", ";
                                                                    }
                                                                }
                                                            }
                                                        }*@

                                                    @*Load học phần học trước*@
                                                    @*@{
                                                            string d = "";
                                                            if (item.MonHT != null)
                                                            {
                                                                string[] hphoctruoc = item.MonHT.Split(',');
                                                                CurriculumManagementSystem.Models.CMSEntities db = new CurriculumManagementSystem.Models.CMSEntities();
                                                                for (z = 0; z < hphoctruoc.Length; z++)
                                                                {
                                                                    string mhp = hphoctruoc[z];
                                                                    string tenhp = db.sc_Hocphan.Where(s => s.MaMH.ToString() == mhp).FirstOrDefault().TenMH;
                                                                    if (z == hphoctruoc.Length - 1)
                                                                    {
                                                                        d += tenhp;
                                                                    }
                                                                    else
                                                                    {
                                                                        d += tenhp + ", ";
                                                                    }
                                                                }
                                                            }
                                                        }*@

                                                    @*<td style="text-align:center ;vertical-align: middle">@c</td>
                                                        <td style="text-align:center ;vertical-align: middle">@d</td>*@
                                                    <td style="text-align:center ;vertical-align: middle">@item.SoTC</td>
                                                    <td style="text-align:center ;vertical-align: middle">@item.GioLT</td>
                                                    <td style="text-align:center ;vertical-align: middle">@item.GioTH</td>
                                                    <td style="text-align:center ;vertical-align: middle">@item.GioDA</td>
                                                    <td style="text-align:center;vertical-align: middle ">@item.GioTT</td>
                                                    <td style="text-align:center;vertical-align: middle">@item.Hinhthuc</td>
                                                    <td style="text-align:center;vertical-align: middle">@item.Hocky</td>
                                                    <td style="vertical-align: middle; text-align:center">
                                                        <a title="Chỉnh sửa" data-id="@item.MaKHDT" class="edit" data-toggle="modal" data-target="#editsubjectmodal" href="javascript:void(0)"><img src="~/Areas/CMS/images/IconEdit.png" style="width:25px;"></a>
                                                        <a title="Xóa" data-id="@item.MaKHDT" class="delete" onclick="javascript:return ShowMessagexoakqhtmd();" href="javascript:void(0)"><img src="~/Areas/CMS/images/IconBin3.png" /></a>
                                                    </td>
                                                </tr>
                                                i++;
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-6" style="margin-top:10px; margin-left:-15px;">
                                    <button type="button" class="btn btn-success" style="color:white;margin-left:15px" data-toggle="modal" data-target="#reviewHp">Xem chi tiêt</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    @*Ma trận giữa danh sách học phần và chuẩn đầu ra chương trình đào tạo*@
                    <div class="row">
                        <div class="col-lg-7" style="margin-left:2%">
                            <a class="btn btn1table" style="border-color:firebrick"><img src="~/Areas/CMS/images/IconDown.png" style="width:18px" alt="Alternate Text" /> </a>
                            <a class="btn btn2table" style="border-color:firebrick"><img src="~/Areas/CMS/images/IconUp.png" style="width:18px" alt="Alternate Text" /> </a>
                            <label>Ma trận quan hệ giữa học phần với chuẩn đầu ra CTDT:</label>
                        </div>
                    </div>
                    @*Table *@
                    <div class="card tablemapping">
                        <hr />
                        <div class="card-body">
                            <div class="table-responsive">
                                <br />
                                <br />
                                <table class="table table-striped table-bordered" id="myTable">
                                    <thead>
                                        <tr style="text-align:center ; background-color:firebrick; color:white">
                                            <th style="text-align:center; vertical-align: middle; width:30%">Danh sách học phần</th>
                                            <th style="text-align:center; vertical-align: middle;width:60% ">Chuẩn đầu ra chương trình đào tạo</th>

                                        </tr>
                                    </thead>
                                    <tbody id="myTable">
                                        @foreach (var item in Model.FirstOrDefault().khdaotao)
                                        {
                                            <tr class="odd gradeX">
                                                <td id="tenhocphan" style="text-align:center;vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                <td>
                                                    <div class="form-group row">
                                                        <select class="select2 form-control m-t-15" multiple="multiple" style="width:100%; margin-top:10%" id="tb-@item.MaKHDT">
                                                            @foreach (var a in Model.FirstOrDefault().cdrctdt)
                                                            {

                                                                {
                                                                    <option value="@a.MaELO">@a.MaHT - @a.Mota</option>
                                                                }

                                                            }

                                                        </select>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <button id="luumatranhpvacdr" type="button" class="btn btn-success" style="color:white">Lưu</button>
                        </div>
                    </div>

                    <br />
                    <hr />
                    @*<input type="submit" class="btn" style="float:right;border-radius:25px; background-color:#b22222; color:white; border: 2px solid #ffffff;" href="@Url.Action("EditCTDTStep4","CTDTKhung", new { id = Model.FirstOrDefault().ctdt.MaCTDT })" value="Tiếp tục" />*@
                    <a id="step3" class="btn" style="float:right;border-radius:25px; background-color:#b22222; color:white; border: 2px solid #ffffff;" href="javascript:void()">Tiếp tục</a>
                    <a class="btn " style="float:right; margin-right:1%;border-radius:25px ;color:black;border-bottom-color:#b22222; border: 1px solid #b22222;" href="@Url.Action("EditCTDTStep2","CTDTKhung", new {id = Model.FirstOrDefault().ctdt.MaCT })">Quay lại</a>

                </form>
                @*nut len dau trang*@
                <div class='lentop'>
                    <div>
                        <img src='https://1.bp.blogspot.com/-k6sikOdzFXQ/VwqCKDosmEI/AAAAAAAAKxE/nLxLhkTIO6o3iE5ZWmtxo2bf4QHdzPQNQ/s1600/top.png' />
                    </div>
                </div>
                <br />
                @*Form xem danh sách học phần theo những dạng khác nhau*@
                <div class="modal fade" id="reviewHp" tabindex="-1" role="dialog" aria-labelledby="evaluateCTDTLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" @*role="document"*@ style="font-size:medium">
                        <div class="modal-content" style="background-color:#eeeeee">
                            <div class="modal-header" style="background-color:#d51c29; color:white">
                                <h5 class="modal-title" id="evaluteCTDTLabel">Học phần</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row" style="background-color:white ; margin-left:auto;margin-right:auto">
                                    <hr />
                                    <div class="col-md-12" style="margin-top:10px">
                                        <ul class="nav nav-pills nav-justified" role="tablist">
                                            <li class="nav-item" style="border-radius: 5px">
                                                <a class="nav-link danhsachhocphan active show" data-toggle="tab" style="border-color:black">Danh sách Học phần theo loại kiến thức</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link hocphantheonam" data-toggle="tab">Danh sách HP tiên quyết và HP trước </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link theohocky" data-toggle="tab">Danh sách Học phần theo học kỳ</a>
                                            </li>
                                        </ul>
                                        <hr />
                                    </div>
                                    <div class="card card-body printableArea">
                                        <div class="row">
                                            <div class="col-md-12">
                                                @*Bảng danh sách học phần theo loại kiến thức*@
                                                <div id="conTent1">
                                                    <div class="table-responsive">
                                                        <br />
                                                        <br />
                                                        <table class="table table-bordered ">
                                                            <thead>
                                                                @*Tiêu đề*@
                                                                <tr style="text-align:center ; background-color:firebrick; color:white">
                                                                    <th style="text-align:center; vertical-align: middle">STT</th>
                                                                    <th style="text-align:center; vertical-align: middle">Loại kiến thức</th>
                                                                    <th style="text-align:center; vertical-align: middle">Mã học phần</th>
                                                                    <th style="text-align:center; vertical-align: middle">Tên học phần</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "13"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "14"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "12"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "11"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "10"))
                                                                {

                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "9"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "8"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "6"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.MaKhoiKT.ToString() == "7"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@x</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Khoikienthuc.Mota</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                    </tr>
                                                                    x++;
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                @*Bảng danh sách học phần theo học phần tiên quyết và học phần học trước*@
                                                <div id="conTent2">
                                                    <div class="table-responsive">
                                                        <br />
                                                        <br />
                                                        <table class="table table-bordered ">
                                                            <thead>
                                                                @*Tiêu đề*@
                                                                <tr style="text-align:center ; background-color:firebrick; color:white">
                                                                    <th style="text-align:center; vertical-align: middle">STT</th>
                                                                    <th style="text-align:center; vertical-align: middle">Mã học phần</th>
                                                                    <th style="text-align:center; vertical-align: middle">Tên học phần</th>
                                                                    <th style="text-align:center; vertical-align: middle">Tên học phần tiên quyết</th>
                                                                    <th style="text-align:center; vertical-align: middle">Tên học phần trước</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao)
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@y</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>

                                                                        @*Load học phần tiên quyết*@
                                                                        @{
                                                                            string c = "";
                                                                            if (item.MonTQ != null)
                                                                            {
                                                                                string[] hptienquyet = item.MonTQ.Split(',');
                                                                                Capstone.Models.fit_misDBEntities db = new Capstone.Models.fit_misDBEntities();
                                                                                for (z = 0; z < hptienquyet.Length; z++)
                                                                                {
                                                                                    string mhp = hptienquyet[z];
                                                                                    string tenhp = db.sc_Hocphan.Where(s => s.MaMH.ToString() == mhp).FirstOrDefault().TenMH;
                                                                                    if (z == hptienquyet.Length - 1)
                                                                                    {
                                                                                        c += tenhp;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        c += tenhp + ", ";
                                                                                    }
                                                                                }
                                                                            }
                                                                        }

                                                                        <td style="text-align:center; vertical-align: middle">@c</td>

                                                                        @*Load học phần học trước*@
                                                                        @{
                                                                            string d = "";
                                                                            if (item.MonHT != null)
                                                                            {
                                                                                string[] hphoctruoc = item.MonHT.Split(',');
                                                                                Capstone.Models.fit_misDBEntities db = new Capstone.Models.fit_misDBEntities();
                                                                                for (z = 0; z < hphoctruoc.Length; z++)
                                                                                {
                                                                                    string mhp = hphoctruoc[z];
                                                                                    string tenhp = db.sc_Hocphan.Where(s => s.MaMH.ToString() == mhp).FirstOrDefault().TenMH;
                                                                                    if (z == hphoctruoc.Length - 1)
                                                                                    {
                                                                                        d += tenhp;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        d += tenhp + ", ";
                                                                                    }
                                                                                }
                                                                            }
                                                                        }

                                                                        <td style="text-align:center; vertical-align: middle">@d</td>
                                                                    </tr>
                                                                    y++;
                                                                }

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                @*Bảng danh sách học phần theo học kỳ*@
                                                <div id="conTent3">
                                                    <div class="table-responsive">
                                                        <br />
                                                        <br />
                                                        <table class="table table-bordered ">
                                                            <thead>
                                                                @*Tiêu đề*@
                                                                <tr style="text-align:center ; background-color:firebrick; color:white">
                                                                    <th style="text-align:center; vertical-align: middle">STT</th>
                                                                    <th style="text-align:center; vertical-align: middle">Học kỳ</th>
                                                                    <th style="text-align:center; vertical-align: middle">Mã học phần</th>
                                                                    <th style="text-align:center; vertical-align: middle">Tên học phần</th>
                                                                    <th style="text-align:center; vertical-align: middle">Số tín chỉ</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "1"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "2"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "3"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "4"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">4</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "5"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "6"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "7"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }

                                                                @foreach (var item in Model.FirstOrDefault().khdaotao.Where(s => s.Hocky == "8"))
                                                                {
                                                                    <tr class="odd gradeX">
                                                                        <td style="text-align:center; vertical-align: middle">@z</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.Hocky</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.MaHT</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.sc_Hocphan.TenMH</td>
                                                                        <td style="text-align:center; vertical-align: middle">@item.SoTC</td>
                                                                    </tr>
                                                                    z++;
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer" style="background-color:white">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                            </div>
                            @*Kết thúc form xem danh sách các học phần*@
                        </div>
                    </div>
                </div>
                @*Form thêm mới môn học*@
                <div class="modal fade" id="addSubjectModal" tabindex="-1" role="dialog" aria-labelledby="edit SubjectModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header" style="background-color:#d51c29; color:white">
                                <h5 class="modal-title" id="addSubjectModalLabel">Thêm học phần</h5>
                                <button id="nutxdongformthemhocphan" type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="formthemhocphan" style="margin-left:10px">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <input type="hidden" id="makhdt" />
                                                    <label>Mã học phần</label><label style="color:red">*</label>
                                                    <input id="mahienthi" name="mahienthi1" type="text" autofocus class="form-control" />
                                                    <div class="invalid-feedback">
                                                        @CommonRS.Resources.ValidationMes.mes_MaHT
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <label>Tên học phần</label><label style="color:red">*</label>
                                                    <input id="tenmonhoc" name="tenmonhoc1" type="text" class="form-control" />
                                                    <div class="invalid-feedback">
                                                        @CommonRS.Resources.ValidationMes.mes_TenHP
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label>Khối kiến thức </label><label style="color:red">*</label>
                                                    <select class="form-control" style="width:100%" id="khoikt">
                                                        @foreach (var item in Model.FirstOrDefault().khoikienthuc)
                                                        {
                                                            <option hidden>Chọn khối kiến thức</option>
                                                            <option value="@item.MaKhoiKT">@item.Mota</option>
                                                        }
                                                    </select>
                                                    <div class="invalid-feedback">
                                                        @CommonRS.Resources.ValidationMes.mes_LoaiKienThuc
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Loại kiến thức</label>
                                                    <select class="form-control" style="width:100%" id="loaikt">
                                                        <option hidden>Chọn loại kiến thức</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <label class="col-md-5">Hình thức <label style="color:red">*</label> </label>
                                            <div class="col-md-7" style="margin-top:8px">

                                                <div class="custom-control custom-radio" style="float: left ;padding-left:0px;">
                                                    <input type="radio" class="custom-control-input" id="batbuoc" name="radio-stacked">
                                                    <label class="custom-control-label" for="batbuoc">&nbsp; &nbsp; &nbsp; &nbsp; Bắt buộc</label>
                                                </div>

                                                <div class="custom-control custom-radio" style="float:right;padding-left:0px;">
                                                    <input type="radio" class="custom-control-input" id="tuchon" name="radio-stacked">
                                                    <label class="custom-control-label" for="tuchon">&nbsp; &nbsp; &nbsp; &nbsp; Tự chọn</label>
                                                </div>


                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="custom-control custom-checkbox" style="float: left; padding-left:0px;">
                                                    <input type="checkbox" class="custom-control-input" id="hpTienquyet" name="checkbox-stacked">
                                                    <label class="custom-control-label" for="hpTienquyet" style="float:left">&nbsp; &nbsp; &nbsp; &nbsp; HP tiên quyết</label>
                                                </div>

                                            </div>
                                            <div class="col-md-6">
                                                <div class="custom-control custom-checkbox" style="float:left; padding-left:0px;">
                                                    <input type="checkbox" class="custom-control-input" id="hpTruoc" name="checkbox-stacked">
                                                    <label class="custom-control-label" for="hpTruoc" style="float:left">&nbsp; &nbsp; &nbsp; &nbsp; HP học trước</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <div id="showHptienquyet">
                                                    <br />
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <select class="select2 form-control m-t-15" multiple="multiple" style="width:100%; margin-top:10%" id="hocphantienquyet">
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao)
                                                                {
                                                                    <option value="@item.sc_Hocphan.MaMH">@item.sc_Hocphan.TenMH</option>
                                                                }

                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div id="showHptruoc">
                                                    <br />
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <select class="select2 form-control m-t-15" multiple="multiple" style="width:100%; margin-top:10%" id="hocphanhoctruoc">
                                                                @foreach (var item in Model.FirstOrDefault().khdaotao)
                                                                {
                                                                    <option value="@item.sc_Hocphan.MaMH">@item.sc_Hocphan.TenMH</option>
                                                                }

                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-6">
                                            <label for="dtts">Số tín chỉ</label>
                                            <input type="number" min="1" max="20" id="sotinchi" class="form-control sotinchi" disabled>
                                        </div>
                                        <div class="col-6">
                                            <label>Học kỳ</label><label style="color:red">*</label>
                                            <input type="number" name="hocky" min="1" max="8" id="hocky" class="form-control" onkeyup="if (this.value > 8) this.value = 1; if (this.value == null) this.value = 0">
                                            <div class="invalid-feedback">
                                                @CommonRS.Resources.ValidationMes.mes_HocKy
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <label for="dtts">Lý thuyết</label>
                                            <input type="number" min="1" max="6" id="lythuyet" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 6 ) this.value = 1; if (this.value == null) this.value = 0">
                                            <label for="dtts">Thực hành</label>
                                            <input type="number" min="1" max="20" id="thuchanh" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 20 ) this.value = 1; if (this.value == null) this.value = 0">
                                        </div>
                                        <div class="col-6">
                                            <label for="dtts">Đồ án</label>
                                            <input type="number" min="1" max="20" id="doan" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 20 ) this.value = 1; if (this.value == null) this.value = 0 ">
                                            <label for="dtts">Thực tập</label>
                                            <input type="number" min="1" max="6" id="thuctap" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 6 ) this.value = 1;if (this.value == null) this.value = 0">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <label for="dtts">Mục tiêu học phần</label>
                                            <textarea id="muctieumh" name="muctieumh" class="form-control" rows="3"></textarea>
                                            <label for="dtts">Mô tả học phần</label>
                                            <textarea id="motamh" name="motamh" class="form-control" rows="3"></textarea>
                                        </div>
                                        <hr />
                                    </div>

                                </form>
                            </div>
                            <div class="modal-footer">
                                <button id="dongformthemhocphan" type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                                <button type="button" class="btn btn-success" onclick="javascript()" id="btnAddSubject">Lưu</button>
                            </div>
                        </div>
                    </div>
                </div>
                @*Form chỉnh sửa học phần*@
                <div class="modal fade" id="editsubjectmodal" tabindex="-1" role="dialog" aria-labelledby="edit SubjectModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header" style="background-color:#d51c29; color:white">
                                <h5 class="modal-title" id="addSubjectModalLabel">Chỉnh sửa học phần</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form style="margin-left:10px">
                                    <div class="row">

                                        <div class="col-md-12">
                                            <input type="hidden" id="editmakhdt" />
                                            <input type="hidden" id="editmahp" />
                                            <input type="hidden" id="makhdt" />
                                            <label>Mã hiển thị: </label>
                                            <input id="editmaht" name="maHocphan" type="text" class="form-control" maxlength="10" />

                                            <label>Tên học phần: </label>
                                            <input id="edittenmonhoc" name="tenmonhoc" type="text" class="form-control" maxlength="100" />

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label>Khối kiến thức </label><label style="color:red">*</label>
                                                    <select class="form-control" style="width:100%" id="editkhoikt">
                                                        @foreach (var item in Model.FirstOrDefault().khoikienthuc)
                                                        {
                                                            <option hidden>Chọn khối kiến thức</option>
                                                            <option value="@item.MaKhoiKT">@item.Mota</option>
                                                        }
                                                    </select>
                                                    <div class="invalid-feedback">
                                                        @CommonRS.Resources.ValidationMes.mes_LoaiKienThuc
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Loại kiến thức</label><label style="color:red">*</label>
                                                    <select class="form-control" style="width:100%" id="editloaikt">
                                                        <option hidden>Chọn loại kiến thức</option>
                                                    </select>
                                                    <div class="invalid-feedback">
                                                        @CommonRS.Resources.ValidationMes.mes_LoaiKienThuc
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-md-5">Hình thức:</label>
                                        <div class="col-md-7">
                                            <div class="custom-control custom-radio" style="float: left">
                                                <input type="radio" class="custom-control-input" id="editbatbuoc" name="radio-stacked">
                                                <label class="custom-control-label" for="editbatbuoc">&nbsp; &nbsp; &nbsp; &nbsp; Bắt buộc</label>
                                            </div>
                                            <div class="custom-control custom-radio" style="float:right">
                                                <input type="radio" class="custom-control-input" id="edittuchon" name="radio-stacked">
                                                <label class="custom-control-label" for="edittuchon">&nbsp; &nbsp; &nbsp; &nbsp; Tự chọn</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-6">
                                            <div class="custom-control custom-checkbox" style="float: left">
                                                <input type="checkbox" class="custom-control-input" name="checkbox-stacked">
                                                <label class="custom-control-label" for="edithpTienquyet" style="float:left">&nbsp; &nbsp; &nbsp; &nbsp; HP tiên quyết</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="custom-control custom-checkbox" style="float:right">
                                                <input type="checkbox" class="custom-control-input" name="checkbox-stacked">
                                                <label class="custom-control-label" for="edithpTruoc" style="float:left">&nbsp; &nbsp; &nbsp; &nbsp; HP học trước</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <hr />
                                        @*Học phần tiên quyết*@
                                        <div class="col-6">
                                            <div id="showHptienquyet">
                                                <div class="col-12">
                                                    <div class="form-group row">
                                                        <select class="select2 form-control m-t-15" multiple="multiple" style="width:100%; margin-top:10%" id="edithptienquyet">
                                                            @foreach (var item in Model.FirstOrDefault().khdaotao)
                                                            {
                                                                <option value="@item.MaHP">@item.sc_Hocphan.TenMH</option>
                                                            }

                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            @*Học phần trước*@
                                            <div id="showHptruoc">
                                                <div class="col-12">
                                                    <div class="form-group row">
                                                        <select class="select2 form-control m-t-15" multiple="multiple" style="width:100%; margin-top:10%" id="edithocphantruoc">
                                                            @foreach (var item in Model.FirstOrDefault().khdaotao)
                                                            {
                                                                <option value="@item.MaHP">@item.sc_Hocphan.TenMH</option>
                                                            }

                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <label for="dtts">Số tín chỉ: </label>
                                            <input type="number" min="1" max="20" id="editsotinchi" class="form-control sotinchi" disabled>
                                        </div>
                                        <div class="col-6">
                                            <label>Học kỳ:</label>
                                            <input type="number" name="hocky" min="1" max="8" id="edithocky" class="form-control" onkeyup="if (this.value > 8) this.value = 1; if (this.value == null) this.value = 0">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <label for="dtts">Lý thuyết: </label>
                                            <input type="number" min="1" max="6" id="editlythuyet" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 6 ) this.value = 1; if (this.value == null) this.value = 0">
                                            <label for="dtts">Thực hành: </label>
                                            <input type="number" min="1" max="20" id="editthuchanh" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 20 ) this.value = 1; if (this.value == null) this.value = 0">
                                        </div>
                                        <div class="col-6">
                                            <label for="dtts">Đồ án: </label>
                                            <input type="number" min="1" max="20" id="editdoan" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 20 ) this.value = 1; if (this.value == null) this.value = 0 ">
                                            <label for="dtts">Thực tập: </label>
                                            <input type="number" min="1" max="6" id="editthuctap" oninput="myFunction()" class="form-control" onkeyup="if (this.value > 6 ) this.value = 1;if (this.value == null) this.value = 0">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <label for="dtts">Mục tiêu học phần: </label>
                                            <textarea id="editmuctieumh" name="muctieumh" class="form-control" rows="3"></textarea>
                                            <label for="dtts">Mô tả học phần: </label>
                                            <textarea id="editmotamh" name="motamh" class="form-control" rows="3"></textarea>
                                        </div>
                                        <hr />
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                                <button type="button" class="btn btn-success" onclick="javascript" id="btnluuchinhsuamonhoc">Lưu</button>
                            </div>
                        </div>
                    </div>
                </div>
                @*End Form*@
            </div>
        </div>
    </div>
</div>

<script src="~/Content/Curriculum/assets/libs/toastr/build/toastr.min.js"></script>

<script>
    document.getElementById("step3").addEventListener("click", function (event) {
        event.preventDefault();
        var check = localStorage.getItem("checkmatranstep3");
        if (check == null) {
            if (issave) {
                location.href = "@Url.Action("EditCTDTStep4", "CTDTKhung", new { area = "CMS" })"
            } else {
                    toastr.error("@CommonRS.Resources.ValidationMes.mes_LuuMaTranTruocKhiTiepTuc", "Lỗi")
            }
        } else {
            location.href = "@Url.Action("EditCTDTStep4", "CTDTKhung", new { area = "CMS" })"
        }

    });
</script>
@*<script>
        //truyển id qua bước 4
        document.getElementById("step3").addEventListener("click", function (event) {
            event.preventDefault();
            var idctdt = ($('#idmactdt').val());
            location.href = "/CTDTKhung/EditCTDTStep4/" + idctdt
        });
    </script>*@
@*JS nút đóng form thêm mới học phần reset dữ liệu*@
<script>
    document.getElementById("dongformthemhocphan").addEventListener("click", function () {
        document.getElementById("formthemhocphan").reset();
    });
</script>
@*JS cho nút X đóng form thêm mới học phần reset dữ liệu*@
<script>
    document.getElementById("nutxdongformthemhocphan").addEventListener("click", function () {
        document.getElementById("formthemhocphan").reset();
    });
</script>
<script>
    // Checkbox môn tiên quyêt - môn học trước
    $("#showHptienquyet").hide();
    $("#showHptruoc").hide();
    $(document).ready(function () {
        $('#hpTienquyet').change(function () {
            if (this.checked)
                $('#showHptienquyet').show('slow');
            else
                $('#showHptienquyet').hide('slow');
        });
        $('#hpTruoc').change(function () {
            if (this.checked)
                $('#showHptruoc').show('slow');
            else
                $('#showHptruoc').hide('slow');
        });
    });
</script>
<script>
    //  Sum sô tín chỉ add
    function myFunction() {
        var lt = document.getElementById("lythuyet");
        var th = document.getElementById("thuchanh");
        var doan = document.getElementById("doan");
        var thuctap = document.getElementById("thuctap");
        var tong = +lt.value + +th.value + +doan.value + +thuctap.value;
        document.getElementById('sotinchi').value = tong;
    }
    //  Sum sô tín chỉ edit
    function myFunctione() {
        var lt = document.getElementById("editlythuyet");
        var th = document.getElementById("editthuchanh");
        var doan = document.getElementById("editdoan");
        var thuctap = document.getElementById("editthuctap");
        var tong = +lt.value + +th.value + +doan.value + +thuctap.value;
        document.getElementById('editsotinchi').value = tong;
    }

</script>
<script>
    $(document).ready(function () {
        $("#conTent2").hide();
        $("#conTent3").hide();
        $('.danhsachhocphan').click(function () {
            $("#conTent1").show('slow');
            $("#conTent2").hide();
            $("#conTent3").hide();
        });
        $('.hocphantheonam').click(function () {
            $("#conTent2").show('slow');
            $("#conTent1").hide();
            $("#conTent3").hide();

        });
        $('.theohocky').click(function () {
            $("#conTent3").show('slow');
            $("#conTent1").hide();
            $("#conTent2").hide();
        });
        //Button dropdown table
        $(".tablemapping").hide();
        $(".btn2table").hide()
        $(".btn1table").click(function () {
            $(".tablemapping").show('slow');
            $(".btn2table").show()
            $(".btn1table").hide()
        });
        $(".btn2table").click(function () {
            $(".tablemapping").hide('slow');
            $(".btn1table").show();
            $(".btn2table").hide();
        });
    });
</script>
<script>
    //tìm kiếm
    $(document).ready(function () {
        $("#myInput").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#myTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>
<script>

    $(".select2").select2();

</script>
<script src="~/Areas/CMS/Content/Curriculum/assets/libs/toastr/build/toastr.min.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/assets/extra-libs/DataTables/datatables.min.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/dist/js/CTDTKeHoach.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/assets/libs/jquery-steps/build/jquery.steps.min.js"></script>
<script>
    //lên đầu trang
    $(function () {
        $(window).scroll(function () {
            if ($(this).scrollTop() > 100) $(".lentop").fadeIn();
            else $(".lentop").fadeOut();
        });
        $(".lentop").click(function () {
            $("body,html").animate({ scrollTop: 0 }, "slow");
        });
    });
</script>
@*JS cho nút lưu thông tin thêm mới môn học*@
<script>
    //truyen json qua controller
    document.getElementById("btnAddSubject").addEventListener("click", function (event) {

        //Bắt buộc nhập thông tin học phần(Mã hiển thị, Tên học phần, Loại kiến thức, Hình thức, Học kì)
        var checkvaluemahienthi = $('#mahienthi').val();
        var checkvaluetenhocphan = $('#tenmonhoc').val();
        var checkvalueloaikt = $('#loaikt').val();
        var checkvaluehinhthucbatbuoc = $('#batbuoc').is(':checked');
        var checkvaluehinhthuctuchon = $('#tuchon').is(':checked')
        var checkvaluehocky = $('#hocky').val();
        if (checkvaluemahienthi == "") {
            $("#mahienthi").addClass("is-invalid");
        } else {
            $("#mahienthi").removeClass("is-invalid");
        }
        if (checkvaluetenhocphan == "") {
            $("#tenmonhoc").addClass("is-invalid");
        } else {
            $("#tenmonhoc").removeClass("is-invalid");
        }
        if (checkvalueloaikt == "Chọn loại kiến thức") {
            $("#loaikt").addClass("is-invalid");
        } else {
            $("#loaikt").removeClass("is-invalid");
        }
        if (checkvaluehinhthucbatbuoc == false && checkvaluehinhthuctuchon == false) {
            $("#batbuoc").addClass("is-invalid");
            $("#tuchon").addClass("is-invalid");

        } else {
            $("#batbuoc").removeClass("is-invalid");
            $("#tuchon").removeClass("is-invalid");
        }
        if (checkvaluehocky == "") {
            $("#hocky").addClass("is-invalid");
        } else {
            $("#hocky").removeClass("is-invalid");
        }

        if (checkvaluemahienthi != "" && checkvaluetenhocphan != "" && checkvalueloaikt != "Chọn loại kiến thức" && (checkvaluehinhthucbatbuoc == true || checkvaluehinhthuctuchon == true) && checkvaluehocky != "") {

            event.preventDefault();
            //Get data
            var mahienthi = $('#mahienthi').val();
            var tenmonhoc = $('#tenmonhoc').val();
            var loaikt = $('#loaikt').val();
            var hptienquyet = $('#hocphantienquyet').val().toString();
            var hphoctruoc = $('#hocphanhoctruoc').val().toString();
            var sotinchi = $('#sotinchi').val();
            var lythuyet = $('#lythuyet').val();
            var thuchanh = $('#thuchanh').val();
            var doan = $('#doan').val();
            var thuctap = $('#thuctap').val();
            var bbtc = '';
            if (document.getElementById("batbuoc").checked == true) {
                bbtc = "BB";
            }
            if (document.getElementById("tuchon").checked == true) {
                bbtc = "TC";
            }
            var hk = $('#hocky').val();
            var muctieuhp = $('#muctieumh').val();
            var motamh = $('#motamh').val();
            var khdaottao = {
                MonTQ: hptienquyet,
                MonHT: hphoctruoc,
                MaKhoiKT: loaikt,
                SoTC: sotinchi,
                GioLT: lythuyet,
                GioTH: thuchanh,
                GioTT: thuctap,
                GioDA: doan,
                Hinhthuc: bbtc,
                Hocky: hk,
                MuctieuHP: muctieuhp,
                Mota: motamh,
            }
            var hp = {
                TenMH: tenmonhoc,
                MaHT: mahienthi,
            }
            //Json
            var data = {
                khdt: khdaottao,
                hocphan: hp
            };
            console.log(data);
            $.ajax({
                async: true,
                data: JSON.stringify(data),
                type: 'POST',
                url: '@Url.Action("EditCTDTStep3", "CTDTKhung", new { area = "CMS" })',
                dataType: "json",
                contentType: "application/json",
                cache: false,
                error: function (data) {
                    toastr.error(data.Message, '@CommonRS.Resources.ValidationMes.mes_ThemMongHocKhongThanhCong');
                },
                success: function (data) {
                    location.reload();
                    toastr.success(data.Message, '@CommonRS.Resources.ValidationMes.mes_ThemMonHocThanhCong');
                }
            });
        }
    });
</script>


@*Xóa học phần*@
<script>
    var isclose = false;
    function ShowMessagexoakqhtmd() {
        var result = confirm("@CommonRS.Resources.ValidationMes.mes_ConfirmXoaHP");
        if (result) {
            isclose = true;
            return true;
        } else {
            isclose = false;
            return false;
        }
    }
    $(document).ready(function () {
        $('.delete').on('click', function (event) {
            if (!isclose) {
                return true;
            }
            event.preventDefault();
            //Get data
            var makhdt = $(this).data("id");
            //Json
            const data = {
                MaKHDT: makhdt,
            };
            console.log(data);
            $.ajax({
                async: true,
                data: JSON.stringify(data),
                type: 'POST',
                url: '@Url.Action("deleteSubject", "CTDTKhung", new { area = "CMS" })',
                dataType: "json",
                contentType: "application/json",
                cache: false,
                error: function (data) {
                    toastr.warning(data.msg, '@CommonRS.Resources.ValidationMes.mes_XoaLienKetMonHoc');
                },
                success: function (data) {
                    location.reload();
                    toastr.success(data.Message, '@CommonRS.Resources.ValidationMes.mes_XoaMonHocThanhCong');
                }
            });
        });
    });
</script>
@*Load khối kiến thức*@
<script>
    var selectKhoi = document.getElementById("khoikt")
    selectKhoi.addEventListener('change', getLoaikt());
    $(selectKhoi).change(function () {
        getLoaikt();
    })
    function getLoaikt(){
        var idKhoi = $("#khoikt").val();
        if (idKhoi == "Chọn khối kiến thức") {
            return;
        }
        $.ajax({
                type: 'GET',
                url: '@Url.Action("getLoaikt", "CTDTKhung")?maKhoi=' + idKhoi,
                dataType: "json",
                contentType: "application/json",
                error: function (data) {

                    alert(data.Message);
                },
            success: function (data) {
                console.log(data)
                $("#loaikt")[0].innerHTML = ""
                    for (var index in data) {
                        var option = document.createElement("option");
                        option.value = data[index].MaKhoiKT;
                        option.text = data[index].Mota;
                        $("#loaikt")[0].appendChild(option)
                }
                }
            });
    }
</script>
@*Chỉnh sửa thông tin môn học*@
<script>
     function getLoaikt1(){
         var idKhoi = $("#editkhoikt").val();
        if (idKhoi == "Chọn khối kiến thức") {
            return;
        }
        $.ajax({
                type: 'GET',
                url: '@Url.Action("getLoaikt", "CTDTKhung")?maKhoi=' + idKhoi,
                dataType: "json",
                contentType: "application/json",
                error: function (data) {

                    alert(data.Message);
                },
            success: function (data) {
                console.log(data)
                $("#editloaikt")[0].innerHTML = ""
                    for (var index in data) {
                        var option = document.createElement("option");
                        option.value = data[index].MaKhoiKT;
                        option.text = data[index].Mota;
                        $("#editloaikt")[0].appendChild(option)
                }
                }
            });
    }
    $('#editkhoikt').change(function () {
        getLoaikt1()
        console.log('test')
    })

      function getLoaiktEdit(id){
          var idKhoi = $("#editkhoikt").val();
        if (idKhoi == "Chọn khối kiến thức") {
            return;
        }
        $.ajax({
                type: 'GET',
                url: '@Url.Action("getLoaikt", "CTDTKhung")?maKhoi=' + idKhoi,
                dataType: "json",
                contentType: "application/json",
                error: function (data) {

                    alert(data.Message);
                },
            success: function (data) {
                console.log(data)
                $("#editloaikt")[0].innerHTML = ""
                    for (var index in data) {
                        var option = document.createElement("option");
                        option.value = data[index].MaKhoiKT;
                        option.text = data[index].Mota;
                        $("#editloaikt")[0].appendChild(option)
                }
                $('#editloaikt option').each(function () {
                    console.log($(this).val(), id)
                    if ($(this).val() == id) {
                        $(this).prop("selected", true);
                    }
                });
            }

            });
    }

    //lấy dữ liệu môn học
    $(document).ready(function () {
        $('.edit').on('click', function (event) {
            event.preventDefault();
            console.log($("#editloaikt"))
            $("#edithptienquyet option:selected").each(function(){
                $(this).remove()
            })
            $("#edithocphantruoc option:selected").each(function () {
                $(this).remove()
            })

            var makhdt = $(this).data("id");
            //Json
            const data = {
                MaKHDT: makhdt,
            };
            console.log(data);
            $.ajax({
                async: true,
                data: JSON.stringify(data),
                type: 'POST',
                url: '@Url.Action("getDatathongtinmonhoc", "CTDTKhung", new { area = "CMS" })',
                dataType: "json",
                contentType: "application/json",
                cache: false,
                error: function (data) {
                    toastr.error(data.Message, 'Thông báo');
                },
                success: function (data) {

                    console.log(data.monhoc)
                    $("#editkhoikt").val(data.monhoc.MaQH);
                    getLoaiktEdit(data.monhoc.MaKhoiKT);
                    //$("#editloaikt").val(data.monhoc.MaKhoiKT).change();
                    //console.log($("#editloaikt").val())

                    $("#edittenmonhoc").val(data.monhoc.TenMH);
                    $("#editmaht").val(data.monhoc.MaHT);
                    if (data.monhoc.MonTQ != null) {
                        $("#edithptienquyet").val(data.monhoc.MonTQ.split(','));
                        $("#edithptienquyet").trigger('change');
                    }
                    if (data.monhoc.MonHT != null) {
                        $("#edithocphantruoc").val(data.monhoc.MonHT.split(','));
                        $("#edithocphantruoc").trigger('change');
                    }


                    $("#editsotinchi").val(data.monhoc.SoTC);
                    $("#editlythuyet").val(data.monhoc.GioLT);
                    $("#editthuchanh").val(data.monhoc.GioTH);
                    $("#editdoan").val(data.monhoc.GioDA);
                    $("#editthuctap").val(data.monhoc.GioTT);
                    $("#edithocky").val(data.monhoc.Hocky);
                    $("#editmuctieumh").val(data.monhoc.MuctieuHP);
                    $("#editmotamh").val(data.monhoc.Mota);
                    $("#editmakhdt").val(data.monhoc.MaKHDT);
                    if (data.monhoc.Hinhthuc == "BB") {
                        $("#editbatbuoc").prop('checked', true);
                    }
                    if (data.monhoc.Hinhthuc == "TC") {
                        $("#edittuchon").prop('checked', true);
                    }
                    $("#editmahp").val(data.monhoc.MaHP);
                }
            });
        })
    });

    $(document).ready(function () {
        $('#btnluuchinhsuamonhoc').on('click', function (event) {
            var checkvaluemahienthiedit = $('#editmaht').val();
            var checkvaluetenhocphanedit = $('#edittenmonhoc').val();
            var checkvaluehinhthucbatbuocedit = $('#editbatbuoc').is(':checked');
            var checkvaluehinhthuctuchonedit = $('#edittuchon').is(':checked')
            var checkvaluehockyedit = $('#edithocky').val();
            if (checkvaluemahienthiedit == "") {
                $("#editmaht").addClass("is-invalid");
            } else {
                $("#editmaht").removeClass("is-invalid");
            }
            if (checkvaluetenhocphanedit == "") {
                $("#edittenmonhoc").addClass("is-invalid");
            } else {
                $("#edittenmonhoc").removeClass("is-invalid");
            }
            if (checkvaluehinhthucbatbuocedit == false && checkvaluehinhthuctuchonedit == false) {
                $("#editbatbuoc").addClass("is-invalid");
                $("#edittuchon").addClass("is-invalid");

            } else {
                $("#editbatbuoc").removeClass("is-invalid");
                $("#edittuchon").removeClass("is-invalid");
            }
            if (checkvaluehockyedit == "") {
                $("#edithocky").addClass("is-invalid");
            } else {
                $("#edithocky").removeClass("is-invalid");
            }

            if (checkvaluemahienthiedit != "" && checkvaluetenhocphanedit != "" && (checkvaluehinhthucbatbuocedit == true || checkvaluehinhthuctuchonedit == true) && checkvaluehockyedit != "") {
                event.preventDefault();
                var makhdt = $('#editmakhdt').val();
                var editloaikt = $('#editloaikt').val();
                var editkhoikt = $('#editkhoikt').val();
                var edittenmh = $('#edittenmonhoc').val();
                var editmaht = $('#editmaht').val();
                var editmahp = $('#editmahp').val();
                var edithptienquyet = $('#edithptienquyet').val().toString();
                var edithptruoc = $('#edithocphantruoc').val().toString();
                var editsotinchi = $('#editsotinchi').val();
                var editlythuyet = $('#editlythuyet').val();
                var editthuchanh = $('#editthuchanh').val();
                var editdoan = $('#editdoan').val();
                var editthuctap = $('#editthuctap').val();
                var editbbtc = '';
                if (document.getElementById("editbatbuoc").checked == true) {
                    editbbtc = "BB";
                }
                else if (document.getElementById("edittuchon").checked == true) {
                    editbbtc = "TC";
                }
                var edithocky = $('#edithocky').val();
                var editmuctieu = $('#editmuctieumh').val();
                var editmota = $('#editmotamh').val();

                var khdaottao = {
                    MaKHDT: makhdt,
                    MaKhoiKT: editloaikt,
                    MonTQ: edithptienquyet,
                    MonHT: edithptruoc,
                    SoTC: editsotinchi,
                    GioLT: editlythuyet,
                    GioTH: editthuchanh,
                    GioTT: editthuctap,
                    GioDA: editdoan,
                    Hinhthuc: editbbtc,
                    Hocky: edithocky,
                    MuctieuHP: editmuctieu,
                    Mota: editmota,
                }
                var hp = {
                    MaMH: editmahp,
                    TenMH: edittenmh,
                    MaHT: editmaht,
                }
                //Json
                const data = {
                    khdt: khdaottao,
                    hocphan: hp
                };
                console.log(data);
                $.ajax({
                    async: true,
                    data: JSON.stringify(data),
                    type: 'POST',
                    url: '@Url.Action("editthongtinmonhoc", "CTDTKhung", new { area = "CMS" })',
                    dataType: "json",
                    contentType: "application/json",
                    cache: false,
                    error: function (data) {
                        toastr.error(data.msg, '@CommonRS.Resources.ValidationMes.mes_ChinhSuaMonHocThatBai');
                    },
                    success: function (data) {
                        location.reload();
                        toastr.success(data.Message, '@CommonRS.Resources.ValidationMes.mes_ChinhSuaMonHocThanhCong');
                    }
                });
            }
        })
    });
</script>
<script>
    /****************************************
     *       Basic Table                   *
     ****************************************/
    $('#zero_config').DataTable();
</script>

@*Ma trận Edit step 3
    @*JS nút tiếp tục*@

<script>
    document.getElementById("luumatranhpvacdr").addEventListener("click", function (event) {
        event.preventDefault();
        console.log(event)
        @{
            string strmakhdt = "";
            foreach (var item in Model.FirstOrDefault().khdaotao)
            {

                {
                    strmakhdt += item.MaKHDT+",";

                }
            }

        }

        var arrkhdt = [@strmakhdt]

        var arrgui = []

        for (let i = 0; i < arrkhdt.length; i++) {
            let giatri = $("#tb-" + arrkhdt[i]).val()
            console.log("#tb-" + arrkhdt[i], giatri)
            for (let j = 0; j < giatri.length; j++) {
                arrgui.push({ MaELO: parseInt(giatri[j]), MaKHDT: parseInt(arrkhdt[i]) })
            }
        }
        console.log(arrgui)
        const data = {
            mtmh: arrgui,
            arrkhdt: arrkhdt
        }

        $.ajax({
            async: true,
            data: JSON.stringify(data),
            type: 'POST',
            url: '/CMS/CTDTKhung/luumatranstep3',
            dataType: "json",
            contentType: "application/json",
            cache: false,
            error: function (data) {
                toastr.error(data.Message, 'Thông báo');
            },
            success: function (data) {
                if (data.Message == 'Thành công') {
                    toastr.warning(data.Message, '@CommonRS.Resources.ValidationMes.mes_DuLieuMaTranTrong');
                } else {
                    issave = true;
                    toastr.success(data.msg, '@CommonRS.Resources.ValidationMes.mes_LuuMaTranBuoc3');
                }

            }
        });
    })
</script>

@*Load kết quả ma trận step 3*@
<script>
    $(document).ready(function () {
         @{
            foreach (var item in Model.FirstOrDefault().khdaotao)
            {
                var val = item.t_CDR_CTDT.ToList();
                string resus = "";
                foreach(var sd in val)
                {
                    resus += sd.MaELO + ",";
                }

                <text>
        $("#tb-" +@item.MaKHDT).val([@resus])
        $("#tb-" +@item.MaKHDT).trigger('change')
                </text>
            }
        }
        issave = false;
    });
</script>
