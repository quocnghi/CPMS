@model IEnumerable<Capstone.Models.t_CTDaotao>

@{
    ViewBag.Title = "DSMaTran";
    Layout = "~/Areas/CMS/Views/Shared/_Layout.cshtml";
    int i = 1;
}
<link rel="stylesheet" type="text/css" href="~/Areas/CMS/Content/Curriculum/dist/css/TopButton.css">
<link rel="stylesheet" type="text/css" href="~/Areas/CMS/Content/Curriculum/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css">
<div class="page-wrapper" ng-controller="HPController">
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title">Ma Trận Quan Hệ</h4>
                <div class="ml-auto text-right">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Trang Chủ</a></li>
                            <li class="breadcrumb-item" aria-current="page">Quản lí CTDT </li>
                            <li class="breadcrumb-item active" aria-current="page">Ma Trận Quan Hệ </li>

                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="card">
            <div class="card-body wizard-content">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">

                            <table id="zero_config" class="table table-striped table-bordered">
                                <thead style="text-align:center ; background-color: firebrick; color: white">
                                    <tr>
                                        <th scope="col">STT</th>
                                        <th scope="col"> Loại CTDT</th>
                                        <th scope="col">Tên CTDT</th>
                                        @*<th scope="col">Hệ Ngành</th>*@
                                        <th scope="col">Phiên Bản</th>
                                        <th scope="col">Tình Trạng</th>
                                        <th scope="col" style="width:27%">Ma Trận</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td style="text-align: center">@i</td>
                                            @if (item.LoaiCT == "SC")
                                            {
                                                <td>CTDT Khung</td>

                                            }
                                            else
                                            if (item.LoaiCT == "PC")
                                            {
                                                <td>CTDT Kế Hoạch</td>
                                            }
                                            <input type="hidden" id="idmactdt" value="@item.MaCT" />
                                            <td>@item.TenCT</td>
                                            <td style="text-align: center">@item.Phienban</td>
                                            <td style="text-align: center">@item.Tinhtrang</td>
                                            <td style="text-align: center">
                                                <a class="btn btn-outline-purple" style="margin-right:7px" href="@Url.Action("NDCDRView","MaTran", new { ID=item.MaCT })">QH ND-CDR</a>

                                                <a class="btn btn-outline-purple edit" data-id="@item.MaCT" style="margin-left:7px" data-toggle="modal" data-target="#maTranmt-cdr">QH MT-CDR</a>
                                            </td>
                                        </tr>
                                        i++;

                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @*nut len dau trang*@
    <div class='lentop'>
        <div>
            <img src='~/Areas/CMS/images/top.png' />
        </div>
    </div>
    @*Danh sach ma trận mục tiêu - chẩu đầu ra*@
    <div class="modal fade" id="maTranmt-cdr" tabindex="-1" role="dialog" aria-labelledby="evaluateCTDTLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" @*role="document"*@ style="font-size:medium">
            <div class="modal-content" style="background-color:#eeeeee">
                <div class="modal-header" style="background-color:#d51c29; color:white">
                    <h5 class="modal-title" id="evaluteCTDTLabel">Danh sách ma trận</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row" style="background-color:white ; margin-left:auto;margin-right:auto">
                        <hr />
                        <div class="col-md-12" style="margin-top:10px">
                            <ul class="nav nav-pills nav-justified" role="tablist">
                                <li class="nav-item" style="border-radius: 5px">
                                    <a class="nav-link mt-cdr active show" data-toggle="tab" style="border-color:black">Ma trận mục tiêu - Chuẩn đầu ra Chương trình đào tạo </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link hp-cdr" data-toggle="tab">Ma trận học phần - Chuẩn đầu ra Chương trình đào tạo</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link cdr-hp" data-toggle="tab">Dạng khác của Ma trận học phần - Chuẩn đầu ra Chương trình đào tạo</a>
                                </li>
                            </ul>
                            <hr />
                        </div>
                        <div class="card card-body printableArea">
                            <div class="row" style="margin-top: -15px;">
                                <div class="col-md-12">
                                    @*Ma trận giữa mục tiêu và chuẩn đầu ra*@
                                    <div id="conTent1">
                                        <div class="table-responsive">
                                            <br />
                                            <br />
                                            <table class="table table-bordered" style="font-size:16px;">
                                                <thead>
                                                    <tr style="text-align:center; color:black; ">
                                                        <th style="text-align:center">STT</th>
                                                        <th style="text-align:center">Phân loại</th>
                                                        <th style="text-align:center">Mô tả mục tiêu đào tạo cụ thể</th>
                                                        <th style="text-align:center">Mô tả chuẩn đầu ra</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="mtdtcuthe">
                                                    <tr>
                                                        <td style="text-align:center;vertical-align: middle"></td>
                                                        <td id="phanloaimtdtcuthe" style="text-align:center;vertical-align: middle"></td>
                                                        <td id="motamtdtcuthe" style="text-align:center;vertical-align: middle"><a title="Xem lại" href="#" data-toggle="modal" data-target="#hpReview" style="margin:5px;"></a></td>
                                                        <td id="chuandauraCTDT" style="text-align:center;vertical-align: middle"><a title="Xem lại" href="#" data-toggle="modal" data-target="#hpReview" style="margin:5px;"></a></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    @*Ma trận giữa học phần và chuẩn đầu ra*@
                                    <div id="conTent2">
                                        <div class="table-responsive">
                                            <br />
                                            <br />
                                            <table class="table table-striped table-bordered">
                                                <thead>
                                                    <tr style="text-align:center; color:black; ">
                                                        <th style="text-align:center">STT</th>
                                                        <th style="text-align:center">Mã học phần</th>
                                                        <th style="text-align:center">Tên học phần</th>
                                                        <th style="text-align:center">Mô tả chuẩn đầu ra Chương trình đào tạo</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="noidungctdt">
                                                    <tr>
                                                        <td style="text-align:center;vertical-align: middle"></td>
                                                        <td style="text-align:center;vertical-align: middle"></td>
                                                        <td style="text-align:center;vertical-align: middle"></td>
                                                        <td id="chuandauraCTDT" style="text-align:center;vertical-align: middle"><a title="Xem lại" href="#" data-toggle="modal" data-target="#hpReview" style="margin:5px;"></a></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    @*Dạng khác của Ma trận Chuẩn đầu ra và Học phần CTDT*@
                                    <div id="conTent3">
                                        <div class="table-responsive">
                                            <table id="zero_config" class="table table-striped table-bordered">
                                                <tr>
                                                    <th rowspan="2" style="text-align:center ; background-color:firebrick; color:white; vertical-align:middle;width:6%">Năm 1</th>
                                                    <th style="width:5% ;vertical-align:middle; text-align:center ; background-color:firebrick; color:white">Học kỳ 1</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '1'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <th style="width:5%;vertical-align:middle; text-align:center ; background-color:firebrick; color:white">Học kỳ 2</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '2'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <th rowspan="2" style="text-align:center ; background-color:firebrick; color:white; vertical-align:middle;width:6%">Năm 2</th>
                                                    <th style="width:5%; vertical-align:middle;text-align:center ; background-color:firebrick; color:white">Học kỳ 3</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '3'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <th style="width:5%; vertical-align:middle;text-align:center ; background-color:firebrick; color:white">Học kỳ 4</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '4'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <th rowspan="2" style="text-align:center ; background-color:firebrick; color:white; vertical-align:middle;width:6%">Năm 3</th>
                                                    <th style="width:5%;vertical-align:middle; text-align:center ; background-color:firebrick; color:white">Học kỳ 5</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '5'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <th style="width:5%; vertical-align:middle;text-align:center ; background-color:firebrick; color:white">Học kỳ 6</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '6'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <th rowspan="2" style="text-align:center ; background-color:firebrick; color:white; vertical-align:middle;width:6%">Năm 4</th>
                                                    <th style="width:5%;vertical-align:middle; text-align:center ; background-color:firebrick; color:white" rowspan="2">Học kỳ 7-8</th>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '7'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                                <tr>
                                                    <td style="width:11%" ng-repeat="hp in DSHP" ng-if="hp.Hocky == '8'">{{hp.TenHP}} [{{hp.MaCDR[hp.MaCDR.length - 1].MaHT.substr(0, hp.MaCDR[hp.MaCDR.length - 1].MaHT.length - 1)}}]</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                @*End content*@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="background-color:white">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<script src="~/Areas/CMS/Content/Curriculum/assets/libs/jquery-steps/build/jquery.steps.min.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/assets/extra-libs/DataTables/datatables.min.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/angular/DsHP/HPModel.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/angular/DsHP/HPService.js"></script>
<script src="~/Areas/CMS/Content/Curriculum/angular/DsHP/HPController.js"></script>
<script>
    /****************************************
     *       Basic Table                   *
     ****************************************/
    $('#zero_config').DataTable();
</script>
<script>
    //modal
    $(document).ready(function () {
        $("#conTent2").hide();
        $("#conTent3").hide();
        $('.mt-cdr').click(function () {
            $("#conTent1").show('slow');
            $("#conTent2").hide();
            $("#conTent3").hide();

        });
        $('.hp-cdr').click(function () {
            $("#conTent2").show('slow');
            $("#conTent1").hide();
            $("#conTent3").hide();

        });
        $('.cdr-hp').click(function () {
            $("#conTent3").show('slow');
            $("#conTent1").hide();
            $("#conTent2").hide();
        });

    });
</script>
@*//nut len dau trang*@
<script>
    $(function () {
        $(window).scroll(function () {
            if ($(this).scrollTop() > 100) $(".lentop").fadeIn();
            else $(".lentop").fadeOut();
        });
        $(".lentop").click(function () {
            $("body,html").animate({ scrollTop: 0 }, "slow");
        });
    });
</script>

@*JS hiển thị ma trận Mục tiêu - Chuẩn đầu ra CTDT*@
<script>
    var mactdthientai;
    $(document).ready(function () {
        $('.edit').on('click', function (event) {
            event.preventDefault();
            console.log(event)
            document.getElementById("mtdtcuthe").innerHTML = ""
            //document.getElementById("chuandauraCTDT").innerHTML = ""

            var mactdt = $(this).data("id");
            mactdthientai = mactdt;
            const data = {
                MaCT: mactdt,
            };
            console.log(data);
            $.ajax({
                async: true,
                data: JSON.stringify(data),
                type: 'POST',
                url: '@Url.Action("LaydulieudanhgiaCTDT", "CTDTKhung", new { area = "CMS" })',
                dataType: "json",
                contentType: "application/json",
                cache: false,
                error: function (data) {
                    alert(data.Message);
                },
                success: function (data) {
                    console.log(data.mtdtcuthe)
                    console.log(data.chuandaura)

                    for (let i = 0; i < data.mtdtcuthe.length; i++) {
                        let tr = document.createElement("tr");
                        let td1 = document.createElement("td");
                        let td2 = document.createElement("td");
                        let td3 = document.createElement("td");
                        let td4 = document.createElement("td");

                        td1.style = "text-align:left;vertical-align: left"
                        td1.innerText = i + 1

                        td2.style = "text-align:left;vertical-align: left"
                        td2.innerText = data.mtdtcuthe[i].Phanloai

                        td3.style = "text-align:left;vertical-align: left "
                        td3.innerText = data.mtdtcuthe[i].Mota

                        let mota = '';

                        for (let j = 0; j < data.mtdtcuthe[i].CDR.length; j++) {
                            mota += data.mtdtcuthe[i].CDR[j].Mota + '\n\r'
                        }

                        mota = mota.substr(0, mota.length - 1)
                        td4.style = "text-align:left;vertical-align: left "
                        td4.innerText = mota

                        tr.appendChild(td1)
                        tr.appendChild(td2)
                        tr.appendChild(td3)
                        tr.appendChild(td4)

                        document.getElementById("mtdtcuthe").appendChild(tr);
                    }
                }

            })

        })
    })
</script>

@*JS hiển thị ma trận giữa học phần và chuẩn đầu ra*@
<script>
    var mactdthientai;
    $(document).ready(function () {
        $('.edit').on('click', function (event) {
            event.preventDefault();
            console.log(event)
            document.getElementById("noidungctdt").innerHTML = ""
            //document.getElementById("chuandauraCTDT").innerHTML = ""

            var mactdt = $(this).data("id");
            mactdthientai = mactdt;
            const data = {
                MaCT: mactdt,
            };
            console.log(data);
            $.ajax({
                async: true,
                data: JSON.stringify(data),
                type: 'POST',
                url: '@Url.Action("LaydulieudanhgiaCTDT", "CTDTKhung", new { area = "CMS" })',
                dataType: "json",
                contentType: "application/json",
                cache: false,
                error: function (data) {
                    alert(data.Message);
                },
                success: function (data) {
                    console.log(data.dshocphan);
                    console.log(data.chuandaura);

                    for (let i = 0; i < data.dshocphan.length; i++) {
                        let tr = document.createElement("tr");
                        let td1 = document.createElement("td");
                        let td2 = document.createElement("td");
                        let td3 = document.createElement("td");
                        let td4 = document.createElement("td");

                        td1.style = "text-align:left;vertical-align: left"
                        td1.innerText = i + 1

                        td2.style = "text-align:left;vertical-align: left"
                        td2.innerText = data.dshocphan[i].MaHT

                        td3.style = "text-align:left;vertical-align: left "
                        td3.innerText = data.dshocphan[i].TenMH

                        let mota = '';

                        for (let j = 0; j < data.dshocphan[i].CDR.length; j++) {
                            mota += data.dshocphan[i].CDR[j].Mota + ' \n\r'
                        }

                        mota = mota.substr(0, mota.length - 1)
                        td4.style = "text-align:left;vertical-align: left "
                        td4.innerText = mota

                        tr.appendChild(td1)
                        tr.appendChild(td2)
                        tr.appendChild(td3)
                        tr.appendChild(td4)

                        document.getElementById("noidungctdt").appendChild(tr);
                    }
                }
            })
        })
    })
</script>
